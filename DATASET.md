# Dataset Methodology: `full_states_dataset.json`

This repository ships a **starter proxy dataset** for the freedom model. It is designed to be:

- **Structurally real-data-ready:** domains are defined by concrete actions with explicit friction components.
- **Auditable:** assumptions are visible and editable.
- **Replaceable:** the proxy values are meant to be swapped out over time with primary-source action data.

The scoring/normalization logic that consumes this dataset lives in `script.js`.

## Schema

Top-level:

- `version`: dataset version string
- `generated_at`: ISO date the dataset was last generated/updated
- `notes`: human summary of what changed
- `sources`: provenance for any crawled inputs (URLs + retrieval metadata)
- `jurisdictions[]`: array of states

Each `jurisdiction`:

- `name`: state name (must match UI labels)
- `tax_proxies`: fiscal-control inputs
  - `income_effective_rate` (0..0.8)
  - `payroll_effective_rate` (0..0.3)
  - `sales_effective_rate` (0..0.25)
  - `property_effective_rate` (0..0.05)
  - `marginal_keep_penalty` (0..0.9) where `marginal_keep_rate = 1 - penalty`
  - `household_adjustment`: multiplicative factor by household type
- `domains`: permission-control inputs
  - `housing_rent`, `housing_buy`, `business`, `school`, `speech`, `privacy`, `mobility`
  - each domain has `actions[]`

Each `action`:

- Required:
  - `name`
  - `permission_count` (integer >= 0)
  - `median_days` (integer >= 0)
  - `penalty_severity` (0..1)
- Optional:
  - `weight` (relative importance within the domain; default is 1.0)
  - `days_max` / `permission_max` (normalization caps; see `script.js`)
  - `source` (short provenance string; most current actions are still proxy-derived)

## How The App Uses The Data

The app converts actions into friction scores and aggregates:

- **Action friction** is computed in `script.js`:
  - `permission_count / permission_max` (default max 10)
  - `median_days / days_max` (default max 180)
  - `penalty_severity` (already 0..1)
  - weights inside an action are currently: 40% permissions, 40% time, 20% penalty
- **Domain friction** is a weighted average of its actions (by `weight`).
- **Permission control** is a goal-weighted sum of domain frictions.
- **Fiscal control** is an effective tax rate proxy computed from `tax_proxies` for the user’s context.
- **Freedom** is computed as `1 - combined_control` where combined control mixes fiscal vs permission by user sliders.

## v2.5 Proxy Transforms (Documented)

The v2.5 dataset is generated by a reproducible transform in `scripts/update_dataset.py`.

### Fiscal: `sales_effective_rate` crawl + cache

`tax_proxies.sales_effective_rate` is updated from Tax Foundation’s published table:

- Source: Tax Foundation, “Sales Tax Rates” page (combined state + average local rates)
- The script scrapes the HTML table with id `tablepress-796` (January 2025 table)
- A raw mapping is cached to `sources/taxfoundation_sales_tax_rates_2025-01.json`
- The dataset also stores crawl provenance in `sources.taxfoundation_sales_tax_rates`

This is a proxy: it uses a combined rate, not a true household-level effective rate, but it is a materially better input than a constant placeholder.

### Housing-buy time rescale

`housing_buy` actions can have long approval timelines (hundreds of days). The app’s global default normalization cap is `days_max=180`, which clips these and collapses differences above 180 days.

To prevent clipping, v2.5 sets:

- `days_max = 420` on all `housing_buy` actions
- `permission_max = 12` on all `housing_buy` actions

### Action library expansion (proxy-derived)

To avoid “single-point” domains, v2.5 expands each domain into a small action set. These added actions are still proxies: they are **deterministic transforms of the domain’s base action(s)**, intended to add resolution until true action-level sourcing is available.

Current expansions (implemented in `scripts/update_dataset.py`):

- `housing_rent`
  - weights: short-term rental (0.8), eviction/lease flexibility (1.2)
- `housing_buy`
  - weights: ADU/expand (1.2), major remodel (1.0), zoning variance (0.8)
  - major remodel is derived from the ADU action using simple multipliers + clamps:
    - `permission_count = clamp(round(0.75 * adu.permission_count), 3, 10)`
    - `median_days = clamp(round(0.60 * adu.median_days), 30, days_max)`
    - `penalty_severity = clamp(adu.penalty_severity - 0.10, 0.10, 1.00)`
- `business`
  - base: Start LLC
  - adds:
    - Hire first employee:
      - `permission_count = clamp(round(llc.permission_count + 2), 1, 10)`
      - `median_days = clamp(round(llc.median_days + 7), 0, 60)`
      - `penalty_severity = clamp(llc.penalty_severity + 0.08, 0.10, 1.00)`
    - Contractor vs employee classification:
      - `permission_count = clamp(round(max(1, llc.permission_count - 1)), 1, 10)`
      - `median_days = clamp(round(0.30 * llc.median_days), 0, 30)`
      - `penalty_severity = clamp(llc.penalty_severity + 0.12, 0.10, 1.00)`
- `school`
  - base: Homeschool
  - adds:
    - Homeschool notice/reporting:
      - `permission_count = clamp(round(max(1, hs.permission_count - 1)), 1, 6)`
      - `median_days = clamp(round(0.50 * hs.median_days), 0, 30)`
      - `penalty_severity = clamp(0.80 * hs.penalty_severity, 0.05, 1.00)`
    - Homeschool assessment/testing:
      - `permission_count = clamp(round(hs.permission_count + 1), 1, 8)`
      - `median_days = clamp(round(0.80 * hs.median_days + 2), 0, 45)`
      - `penalty_severity = clamp(hs.penalty_severity + 0.10, 0.05, 1.00)`
- `speech`
  - base: Assembly permit
  - adds:
    - Sound amplification permit:
      - `permission_count = clamp(round(assembly.permission_count + 1), 1, 8)`
      - `median_days = clamp(round(0.60 * assembly.median_days), 0, 30)`
      - `penalty_severity = clamp(assembly.penalty_severity + 0.05, 0.10, 1.00)`
    - Signage/leafleting restrictions:
      - `permission_count = clamp(round(max(1, assembly.permission_count - 1)), 1, 6)`
      - `median_days = 0`
      - `penalty_severity = clamp(0.90 * assembly.penalty_severity, 0.10, 1.00)`
- `privacy`
  - base: Data compliance (also assigns a non-zero `median_days` proxy)
  - adds:
    - Data compliance `median_days` proxy:
      - `median_days = clamp(round(max(10, 10 * permission_count)), 0, 180)`
    - Consumer data requests:
      - `permission_count = clamp(round(data.permission_count), 1, 10)`
      - `median_days = clamp(round(30 + 5 * data.permission_count), 0, 180)`
      - `penalty_severity = clamp(0.90 * data.penalty_severity, 0.10, 1.00)`
    - Breach notification/penalties:
      - `permission_count = clamp(round(max(1, data.permission_count - 1)), 1, 10)`
      - `median_days = clamp(round(10 + 2 * data.permission_count), 0, 90)`
      - `penalty_severity = clamp(data.penalty_severity + 0.05, 0.10, 1.00)`
- `mobility`
  - base: Vehicle registration
  - adds:
    - Inspection/emissions compliance:
      - `permission_count = clamp(round(vehicle.permission_count), 1, 10)`
      - `median_days = clamp(round(max(0, 7 * (vehicle.permission_count - 2))), 0, 60)`
      - `penalty_severity = clamp(vehicle.penalty_severity + 0.05, 0.10, 1.00)`
    - Traffic enforcement penalties:
      - `permission_count = 1`
      - `median_days = 0`
      - `penalty_severity = clamp(vehicle.penalty_severity + 0.10, 0.10, 1.00)`

These transforms are intentionally simple and declared. Replace them with real action-by-action inputs as better data becomes available.

### Rounding / normalization hygiene

To keep diffs stable and the JSON readable, the update script enforces:

- `permission_count`, `median_days`, `days_max`, `permission_max`: integers
- `penalty_severity`: rounded to 2 decimals
- `weight`: rounded to 3 decimals
- `sales_effective_rate`: rounded to 5 decimals

## Reproducing / Updating

Validate current dataset invariants:

```bash
python scripts/validate_dataset.py
```

Regenerate v2.5 transforms (dry run by default):

```bash
python scripts/update_dataset.py
```

Write changes back to disk:

```bash
python scripts/update_dataset.py --write
```

## Limitations (Current)

- Many values remain synthesized proxies; they are not yet tied to specific statutes, agencies, timelines, or enforcement distributions.
- Enforcement variance (county/city) is not modeled.
- Fiscal proxies are incomplete: sales tax is now state-varying; other fiscal inputs still need upgrades to be state-specific and income-contextual.
